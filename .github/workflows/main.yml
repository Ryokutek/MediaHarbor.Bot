name: CI to Docker Hub

on:
  push:
    branches: [ main ]

env:
  MEDIA_HARBOR_BOT_TOKEN: ${{ secrets.MEDIA_HARBOR_BOT_TOKEN }}
  REDIS_PASSWORD: ${{ secrets.REDIS_PASSWORD }}

jobs:
  Deploy:
    runs-on: ryokutek-raspberrypi
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - name: MediaHarbor.Bot Down
      run: sudo docker compose down
      continue-on-error: true
      
    - name: MediaHarbor.Bot Update
      run: sudo docker compose pull
      
    - name: MediaHarbor.Bot Up
      run: sudo docker compose up -d
      env:
        MEDIA_HARBOR_BOT_TOKEN: ${{ secrets.MEDIA_HARBOR_BOT_TOKEN }}
        REDIS_PASSWORD: ${{ secrets.REDIS_PASSWORD }}
